<style type="text/css">
body {font-family: sans-serif;}
p, li, table {letter-spacing: 1px; line-height: 150%;}
h1 {line-height: 150%; letter-spacing: 2px}
p code {font-size: 14px;}
table code {font-size: 14px;}
</style>

<title>Glidix Addressing and Routing System</title>
<h1>Glidix Addressing and Routing System</h1>
<p>
Under Glidix, each network interface may be assigned a list of <i>addresses</i> and <i>routes</i>. There are separate address and route lists for IPv4 and IPv6. An address has the following properties:
</p>

<ul>
<li>The protocol address (the IPv4 or IPv6 address of the interface).</li>
<li>The subnet mask, to determine which part of the address is the network prefix and which is the device ID.</li>
<li>The <i>domain</i>, used in default address selection (described below).</li>
</ul>

<p>
Routes have the following properties:
</p>

<ul>
<li>The destination prefix (e.g. <code>fe80::/64</code>). It may also be the default route.</li>
<li>The gateway, if applicable.</li>
<li>The <i>domain</i>, used in default address selection (described below).</li>
</ul>

<h2>Default Address Selection</h2>
<p>
When a packet is sent out of a socket that is not bound to any address yet, that socket gets bound to a <i>default</i> address. This address is chosen based on the <i>destination</i> address - specifically the route that leads to it. The default address is the first address on the list of addresses of the interface through which the route to the destination leads, that has <i>the same domain as the route</i>.
</p>

<h2>Domains</h2>
<p>
The domain is simply a number and can be used, according to the rules above, to decide which address should be used by default for each destination. Domain numbers 0-15 inclusive are reserved for the system, to help with IPv6 stuff mostly. Here are their intended purposes:
</p>

<ul>
<li><b>0 (<code>DOM_GLOBAL</code>) - Global</b><p>
This domain is given to addresses which are intended to be used for outbound global Internet connections. It is assigned to the default route, and to any other more specific routes that are destined to global addresses. In IPv4, that's typically just the only address in use, and the default route.
</p></li>

<li><b>1 (<code>DOM_LINK</code>) - Link-local</b><p>
This domain is assigned to the link-local IPv6 address (with the <code>fe80::/64</code> prefix) of each interface, and also the <code>fe80::/64</code> route (which is assigned to <i>every</i> interface), hence forcing the system to use link-local addresses when talking to devices using their link-local address. It is also assigned to the <i>link-local multicast route</i> - <code>ff02::/16</code>; but <i>not</i> to any multicast addresses, since we <i>do not</i> want multicast addresses to ever be used as a source address; but we <i>do</i> want the link-local address to be used a source when sending packets destined to link-local multicast addresses.
</p></li>

<li><b>2 (<code>DOM_LOOPBACK</code>) - Loopback</b><p>
This domain is assigned to the loopback unicast addresses (<code>127.0.0.1</code> and <code>::1</code>) as well as the routes to the loopback interface (<code>127.0.0.0/8</code>, <code>::1/128</code> and <code>ff01::/16</code>). This forces Glidix to only use the loopback address when talking to the loopback address.
</p></li>

<li><b>3 (<code>DOM_SITE</code>) - Site-local</b><p>
This domain is assigned to addresses that are only valid on the local network or within the organisation. In IPv6, that's assigned for Unique Local Addresses (ULAs). It may also be used in VPNs. It is also assigned to routes that lead to other devices on said local networks.
</p></li>

<li><b>4 (<code>DOM_MULTICAST</code>) - Multicast addresses</b><p>
This domain is assigned to multicast addresses that are assigned to interfaces. It is <i>never</i> assigned to a route - because we don't want a multicast address to ever be used as a source address; we just want to accept packets with multicast addresses as the destination when we are subscribed to the given multicast group. So, for example, the route <code>ff02::/16</code> (local multicast) will have the <i>link-local</i> domain, because we want to use the <i>link-local</i> address when talking to it. But, the <b>address</b> <code>ff02::1</code> (all nodes) will have the multicast domain, since we want to accept datagrams that are destined to it, but never actually use it as a source address.
</p></li>

<li><b>5 (<code>DOM_NODEFAULT</code>) - Non-default addresses</b><p>
This domain is not usually assigned to routes, but can be. It is assigned to addresses on which we want to listen, but that we do not want to use for outbound connections. The real IPv6 address (derived from the MAC address) is given this domain, such that it is only used for inbound connections but never outbound. In other words, addresses with this domain still belong to us, but are never used as the default address.
</p></li>
